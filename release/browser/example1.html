<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>csound-wasm dev</title>
  </head>
  <body>
    <h1>csound-wasm dev: midi test</h1>
    <button onclick="csound.playCSD(beeper)">Start MIDI</button>
    <script src="./csound-wasm-browser.js"></script>
  <script>
    const beeper = `
    <CsoundSynthesizer>
      <CsOptions>
        -+rtmidi=null -M0
      </CsOptions>
      <CsInstruments>
        ;Example by Andr√©s Cabrera
        sr = 44100
        ksmps = 128
        nchnls = 2
        0dbfs = 1
        ;pgmassign 0, 0
        massign   1, 1 ;assign all MIDI channels to instrument 1
        
        opcode declick, a, a
        ain     xin
        aenv    linseg 0, 0.02, 1, p3 - 0.05, 1, 0.02, 0, 0.01, 0
        xout ain * aenv         ; apply envelope and write output
        endop
        
        instr 1
        iCps    cpsmidi   ;get the frequency from the key pressed
        iAmp    ampmidi   0dbfs * 0.3 ;get the amplitude
        aOut    poscil    iAmp, iCps ;generate a sine tone
        kenv    mxadsr  0.1, 0, 1, 0.5
        aOut *= kenv
        outs      aOut, aOut ;write it to the output
        endin

       instr 2
         asig = poscil:a(0.3, 440)
         outc asig, asig
       endin
      </CsInstruments>
      <CsScore>
      </CsScore>
    </CsoundSynthesizer>
    `

    // const instanciateBeeper = `i 1 0 3600`
    // const singleBeep = `i 2 0 1 200`;
    csound.enableMidi();
    // csound.compileOrc(`       instr 2
    //      asig = poscil:a(0.3, 440)
    //      outc asig, asig
    //    endin`);
    // csound.readScore(singleBeep);
  </script>
</body>
</html>
