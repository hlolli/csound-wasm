<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>csound-wasm dev</title>
  </head>
  <body>
    <h1>csound-wasm dev: midi test</h1>
    <script src="./csound-wasm-browser.js"></script>
  <script>
    const beeper = `

        massign   0, 1 ;assign all MIDI channels to instrument 1
        
        opcode declick, a, a
        ain     xin
        aenv    linseg 0, 0.02, 1, p3 - 0.05, 1, 0.02, 0, 0.01, 0
        xout ain * aenv         ; apply envelope and write output
        endop
        
        instr 1
        prints "MIDI EVT?"
        iCps    cpsmidi   ;get the frequency from the key pressed
        iAmp    ampmidi   0dbfs * 0.3 ;get the amplitude
        aOut    poscil    iAmp, iCps ;generate a sine tone
        kenv    mxadsr  0.1, 0, 1, 0.5
        aOut *= kenv
        outs      aOut, aOut ;write it to the output
        endin
    `

    // const instanciateBeeper = `i 1 0 3600`
    // const singleBeep = `i 2 0 10 200`;
    csound.startRealtime();
    csound.compileOrc(beeper);
    csound.enableMidi();
    // csound.readScore(instanciateBeeper);
  </script>
</body>
</html>
