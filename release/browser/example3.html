<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdn.plot.ly/plotly-1.2.0.min.js"></script>
<title>Csound graphing</title>
<style type="text/css" media="screen">
    #editor { 
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
</style>
</head>
<body>

<div id="editor" style="height:300px">

instr 1
    aNoise poscil 0.5, p4
    aNoise2 poscil 0.5, p4*1.1
    outs aNoise, aNoise2
endin

schedule(1,0,4,200)
</div>
<!-- <button id="start" style="margin-top:310px; height:40px;margin-left:120px">Start Csound</button> -->
<button id="play" style="margin-top:310px; height:40px;margin-left:20px">Play</button>
<div id="tester" style="margin-top:0px;width:600px;height:250px;"></div>

<script>window["csound_worklet_processor_url"] = "./csound-wasm-worklet-processor.js"</script>

<script src="./csound-wasm-browser.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    el = document.getElementById("editor"); 
    text = el.innerHTML; 
    //fix case for csd tags when source is loaded..
    text = text.replace('<cabbage>', '<Cabbage>');
    text = text.replace('</cabbage>', '</Cabbage>');
    text = text.replace('<csoundsynthesizer>', '<CsoundSynthesizer>');
    text = text.replace('</csoundsynthesizer>', '</CsoundSynthesizer>');
    text = text.replace('<csoptions>', '<CsOptions>');
    text = text.replace('</csoptions>', '</CsOptions>');
    text = text.replace('<csinstruments>', '<CsInstruments>');
    text = text.replace('</csinstruments>', '</CsInstruments>');
    text = text.replace('<csscore>', '<CsScore>');
    text = text.replace('</csscore>', '</CsScore>');
    editor = ace.edit(el); 
    editor.session.setValue(text);
    editor.setFontSize(18)
    editor.setBehavioursEnabled(false);
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/csound_orchestra");
    csound.startRealtime({ksmps: 1});

   document.getElementById('play').onclick = ()=>{            
            csound.compileOrc(editor.getValue());
   };

  csound.on('started', () => {
     console.log('Csound Started Event received');
     csound.getTableLength(1).then(len => console.log('len', len));
  });

    </script>
</body>
</html>
